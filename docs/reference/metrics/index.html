<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/veneer/favicons/favicon.ico><link rel=apple-touch-icon href=/veneer/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/veneer/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/veneer/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/veneer/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/veneer/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/veneer/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/veneer/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/veneer/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/veneer/favicons/android-192x192.png sizes=192x192><title>Metrics | Veneer</title>
<meta name=description content="Prometheus metrics exposed by the Veneer controller."><meta property="og:url" content="https://oss.nextdoor.com/veneer/docs/reference/metrics/"><meta property="og:site_name" content="Veneer"><meta property="og:title" content="Metrics"><meta property="og:description" content="Prometheus metrics exposed by the Veneer controller."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="docs"><meta itemprop=name content="Metrics"><meta itemprop=description content="Prometheus metrics exposed by the Veneer controller."><meta itemprop=wordCount content="686"><meta name=twitter:card content="summary"><meta name=twitter:title content="Metrics"><meta name=twitter:description content="Prometheus metrics exposed by the Veneer controller."><link rel=preload href=/veneer/scss/main.min.c8fa29825328ed2efa978460f6b94c9b17d6bb0c0082bfba163e09fa42eea2e8.css as=style integrity="sha256-yPopglMo7S76l4Rg9rlMmxfWuwwAgr+6Fj4J+kLuoug=" crossorigin=anonymous><link href=/veneer/scss/main.min.c8fa29825328ed2efa978460f6b94c9b17d6bb0c0082bfba163e09fa42eea2e8.css rel=stylesheet integrity="sha256-yPopglMo7S76l4Rg9rlMmxfWuwwAgr+6Fj4J+kLuoug=" crossorigin=anonymous><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script></head><body class=td-page><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/veneer/><span class="navbar-brand__logo navbar-logo"></span><span class=navbar-brand__name>Veneer</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/veneer/docs/><i class='fas fa-book'></i><span>Documentation</span></a></li><li class=nav-item><a class=nav-link href=https://github.com/nextdoor/veneer target=_blank rel=noopener><i class='fab fa-github'></i><span>GitHub</span></a></li></ul></div><div class="d-none d-lg-block"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/veneer/offline-search-index.67536b79b1e8092965527dcf4941e8ac.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/veneer/offline-search-index.67536b79b1e8092965527dcf4941e8ac.json data-offline-search-base-href=/ data-offline-search-max-results=10></div><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ms-3 fas fa-bars" type=button data-bs-toggle=collapse data-bs-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="td-sidebar-nav collapse foldable-nav" id=td-section-nav><ul class="td-sidebar-nav__section pe-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-veneerdocs-li><a href=/veneer/docs/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-veneerdocs><span>Documentation</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-veneerdocsgetting-started-li><input type=checkbox id=m-veneerdocsgetting-started-check>
<label for=m-veneerdocsgetting-started-check><a href=/veneer/docs/getting-started/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-veneerdocsgetting-started><span>Getting Started</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-veneerdocsgetting-startedinstallation-li><input type=checkbox id=m-veneerdocsgetting-startedinstallation-check>
<label for=m-veneerdocsgetting-startedinstallation-check><a href=/veneer/docs/getting-started/installation/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-veneerdocsgetting-startedinstallation><span>Installation</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-veneerdocsconcepts-li><input type=checkbox id=m-veneerdocsconcepts-check>
<label for=m-veneerdocsconcepts-check><a href=/veneer/docs/concepts/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-veneerdocsconcepts><span>Concepts</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-veneerdocsconceptsarchitecture-li><input type=checkbox id=m-veneerdocsconceptsarchitecture-check>
<label for=m-veneerdocsconceptsarchitecture-check><a href=/veneer/docs/concepts/architecture/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-veneerdocsconceptsarchitecture><span>Architecture</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-veneerdocsconceptsinstance-selection-li><input type=checkbox id=m-veneerdocsconceptsinstance-selection-check>
<label for=m-veneerdocsconceptsinstance-selection-check><a href=/veneer/docs/concepts/instance-selection/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-veneerdocsconceptsinstance-selection><span>Instance Selection Deep Dive</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-veneerdocsconceptsbinpacking-li><input type=checkbox id=m-veneerdocsconceptsbinpacking-check>
<label for=m-veneerdocsconceptsbinpacking-check><a href=/veneer/docs/concepts/binpacking/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-veneerdocsconceptsbinpacking><span>Bin-Packing and NodeOverlay</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-veneerdocsconceptspreferences-li><input type=checkbox id=m-veneerdocsconceptspreferences-check>
<label for=m-veneerdocsconceptspreferences-check><a href=/veneer/docs/concepts/preferences/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-veneerdocsconceptspreferences><span>Instance Preferences</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-veneerdocsreference-li><input type=checkbox id=m-veneerdocsreference-check checked>
<label for=m-veneerdocsreference-check><a href=/veneer/docs/reference/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-veneerdocsreference><span>Reference</span></a></label><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-veneerdocsreferenceconfiguration-li><input type=checkbox id=m-veneerdocsreferenceconfiguration-check>
<label for=m-veneerdocsreferenceconfiguration-check><a href=/veneer/docs/reference/configuration/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-veneerdocsreferenceconfiguration><span>Configuration</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-veneerdocsreferencemetrics-li><input type=checkbox id=m-veneerdocsreferencemetrics-check checked>
<label for=m-veneerdocsreferencemetrics-check><a href=/veneer/docs/reference/metrics/ class="align-left ps-0 active td-sidebar-link td-sidebar-link__page" id=m-veneerdocsreferencemetrics><span class=td-sidebar-nav-active-item>Metrics</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-veneerdocsreferencehelm-chart-li><input type=checkbox id=m-veneerdocsreferencehelm-chart-check>
<label for=m-veneerdocsreferencehelm-chart-check><a href=/veneer/docs/reference/helm-chart/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-veneerdocsreferencehelm-chart><span>Helm Chart</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-veneerdocsreferencenodeoverlay-li><input type=checkbox id=m-veneerdocsreferencenodeoverlay-check>
<label for=m-veneerdocsreferencenodeoverlay-check><a href=/veneer/docs/reference/nodeoverlay/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-veneerdocsreferencenodeoverlay><span>NodeOverlay CRD</span></a></label></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-veneerdocstroubleshooting-li><input type=checkbox id=m-veneerdocstroubleshooting-check>
<label for=m-veneerdocstroubleshooting-check><a href=/veneer/docs/troubleshooting/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-veneerdocstroubleshooting><span>Troubleshooting</span></a></label></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-veneerdocsdevelopment-li><input type=checkbox id=m-veneerdocsdevelopment-check>
<label for=m-veneerdocsdevelopment-check><a href=/veneer/docs/development/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-veneerdocsdevelopment><span>Development</span></a></label></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ms-2 pb-1 pt-2 mb-0"></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#metrics-at-a-glance>Metrics at a Glance</a></li><li><a href=#reconciliation-metrics>Reconciliation Metrics</a></li><li><a href=#data-source-health-metrics>Data Source Health Metrics</a></li><li><a href=#decision-metrics>Decision Metrics</a></li><li><a href=#reserved-instance-metrics>Reserved Instance Metrics</a></li><li><a href=#savings-plan-metrics>Savings Plan Metrics</a></li><li><a href=#nodeoverlay-lifecycle-metrics>NodeOverlay Lifecycle Metrics</a></li><li><a href=#prometheus-query-metrics>Prometheus Query Metrics</a></li><li><a href=#configuration-metrics>Configuration Metrics</a></li><li><a href=#info-metric>Info Metric</a></li><li><a href=#example-promql-queries>Example PromQL Queries</a><ul><li><a href=#reconciliation-health>Reconciliation Health</a></li><li><a href=#data-source-health>Data Source Health</a></li><li><a href=#overlay-activity>Overlay Activity</a></li><li><a href=#savings-plans-monitoring>Savings Plans Monitoring</a></li></ul></li><li><a href=#grafana-dashboard>Grafana Dashboard</a></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><nav aria-label=breadcrumb class=td-breadcrumbs><ol class=breadcrumb><li class=breadcrumb-item><a href=/veneer/docs/>Documentation</a></li><li class=breadcrumb-item><a href=/veneer/docs/reference/>Reference</a></li><li class="breadcrumb-item active" aria-current=page>Metrics</li></ol></nav><div class=td-content><h1>Metrics</h1><div class=lead>Prometheus metrics exposed by the Veneer controller.</div><header class=article-meta></header><p>Veneer exposes Prometheus metrics on the metrics endpoint (default <code>:8080/metrics</code>, configurable via <a href=/veneer/docs/reference/configuration/><code>metricsBindAddress</code></a>). All metrics use the <code>veneer_</code> namespace prefix.</p><p>Veneer intentionally does <strong>not</strong> duplicate Lumina metrics (which are already in Prometheus). Instead, it focuses on what Veneer decided and what actions it took.</p><h2 id=metrics-at-a-glance>Metrics at a Glance</h2><table><thead><tr><th>Metric</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><a href=/veneer/docs/reference/metrics/#reconciliation-metrics><code>veneer_reconciliation_duration_seconds</code></a></td><td>Histogram</td><td>Duration of reconciliation cycles</td></tr><tr><td><a href=/veneer/docs/reference/metrics/#reconciliation-metrics><code>veneer_reconciliation_total</code></a></td><td>Counter</td><td>Total reconciliation cycles</td></tr><tr><td><a href=/veneer/docs/reference/metrics/#data-source-health-metrics><code>veneer_lumina_data_freshness_seconds</code></a></td><td>Gauge</td><td>Age of Lumina data</td></tr><tr><td><a href=/veneer/docs/reference/metrics/#data-source-health-metrics><code>veneer_lumina_data_available</code></a></td><td>Gauge</td><td>Whether Lumina data is fresh</td></tr><tr><td><a href=/veneer/docs/reference/metrics/#decision-metrics><code>veneer_decision_total</code></a></td><td>Counter</td><td>Decisions made by the engine</td></tr><tr><td><a href=/veneer/docs/reference/metrics/#reserved-instance-metrics><code>veneer_reserved_instance_data_available</code></a></td><td>Gauge</td><td>Whether RI metrics are available</td></tr><tr><td><a href=/veneer/docs/reference/metrics/#reserved-instance-metrics><code>veneer_reserved_instance_count</code></a></td><td>Gauge</td><td>RI count by type and region</td></tr><tr><td><a href=/veneer/docs/reference/metrics/#savings-plan-metrics><code>veneer_savings_plan_utilization_percent</code></a></td><td>Gauge</td><td>SP utilization percentage</td></tr><tr><td><a href=/veneer/docs/reference/metrics/#savings-plan-metrics><code>veneer_savings_plan_remaining_capacity_dollars</code></a></td><td>Gauge</td><td>SP remaining capacity ($/hr)</td></tr><tr><td><a href=/veneer/docs/reference/metrics/#nodeoverlay-lifecycle-metrics><code>veneer_overlay_operations_total</code></a></td><td>Counter</td><td>Total overlay operations</td></tr><tr><td><a href=/veneer/docs/reference/metrics/#nodeoverlay-lifecycle-metrics><code>veneer_overlay_operation_errors_total</code></a></td><td>Counter</td><td>Total overlay operation errors</td></tr><tr><td><a href=/veneer/docs/reference/metrics/#nodeoverlay-lifecycle-metrics><code>veneer_overlay_count</code></a></td><td>Gauge</td><td>Current overlay count</td></tr><tr><td><a href=/veneer/docs/reference/metrics/#prometheus-query-metrics><code>veneer_prometheus_query_duration_seconds</code></a></td><td>Histogram</td><td>Prometheus query duration</td></tr><tr><td><a href=/veneer/docs/reference/metrics/#prometheus-query-metrics><code>veneer_prometheus_query_errors_total</code></a></td><td>Counter</td><td>Prometheus query errors</td></tr><tr><td><a href=/veneer/docs/reference/metrics/#prometheus-query-metrics><code>veneer_prometheus_query_result_count</code></a></td><td>Gauge</td><td>Prometheus query result count</td></tr><tr><td><a href=/veneer/docs/reference/metrics/#configuration-metrics><code>veneer_config_overlays_disabled</code></a></td><td>Gauge</td><td>Whether overlays are disabled</td></tr><tr><td><a href=/veneer/docs/reference/metrics/#configuration-metrics><code>veneer_config_utilization_threshold_percent</code></a></td><td>Gauge</td><td>Configured utilization threshold</td></tr><tr><td><a href=/veneer/docs/reference/metrics/#info-metric><code>veneer_info</code></a></td><td>Gauge</td><td>Controller version info</td></tr></tbody></table><h2 id=reconciliation-metrics>Reconciliation Metrics</h2><table><thead><tr><th>Metric</th><th>Type</th><th>Labels</th><th>Description</th></tr></thead><tbody><tr><td><code>veneer_reconciliation_duration_seconds</code></td><td>Histogram</td><td>&ndash;</td><td>Duration of metrics reconciliation cycles. Buckets: 0.1s to ~51s (exponential).</td></tr><tr><td><code>veneer_reconciliation_total</code></td><td>Counter</td><td><code>result</code></td><td>Total number of reconciliation cycles. Labels: <code>result=success|error</code>.</td></tr></tbody></table><h2 id=data-source-health-metrics>Data Source Health Metrics</h2><table><thead><tr><th>Metric</th><th>Type</th><th>Labels</th><th>Description</th></tr></thead><tbody><tr><td><code>veneer_lumina_data_freshness_seconds</code></td><td>Gauge</td><td>&ndash;</td><td>Age of Lumina data in seconds.</td></tr><tr><td><code>veneer_lumina_data_available</code></td><td>Gauge</td><td>&ndash;</td><td><code>1</code> if Lumina data is available and fresh, <code>0</code> if stale or unavailable.</td></tr></tbody></table><h2 id=decision-metrics>Decision Metrics</h2><table><thead><tr><th>Metric</th><th>Type</th><th>Labels</th><th>Description</th></tr></thead><tbody><tr><td><code>veneer_decision_total</code></td><td>Counter</td><td><code>capacity_type</code>, <code>should_exist</code>, <code>reason</code></td><td>Total decisions made by the decision engine.</td></tr></tbody></table><p><strong>Label values for <code>veneer_decision_total</code>:</strong></p><table><thead><tr><th>Label</th><th>Values</th><th>Description</th></tr></thead><tbody><tr><td><code>capacity_type</code></td><td><code>compute_savings_plan</code>, <code>ec2_instance_savings_plan</code>, <code>reserved_instance</code>, <code>preference</code></td><td>Type of AWS pre-paid capacity</td></tr><tr><td><code>should_exist</code></td><td><code>true</code>, <code>false</code></td><td>Whether an overlay should exist based on the decision</td></tr><tr><td><code>reason</code></td><td><code>capacity_available</code>, <code>utilization_above_threshold</code>, <code>no_capacity</code>, <code>ri_available</code>, <code>ri_not_found</code>, <code>unknown</code></td><td>Reason for the decision</td></tr></tbody></table><h2 id=reserved-instance-metrics>Reserved Instance Metrics</h2><table><thead><tr><th>Metric</th><th>Type</th><th>Labels</th><th>Description</th></tr></thead><tbody><tr><td><code>veneer_reserved_instance_data_available</code></td><td>Gauge</td><td>&ndash;</td><td><code>1</code> if Lumina is exposing RI metrics, <code>0</code> if not.</td></tr><tr><td><code>veneer_reserved_instance_count</code></td><td>Gauge</td><td><code>instance_type</code>, <code>region</code></td><td>Number of Reserved Instances detected by instance type and region.</td></tr></tbody></table><h2 id=savings-plan-metrics>Savings Plan Metrics</h2><table><thead><tr><th>Metric</th><th>Type</th><th>Labels</th><th>Description</th></tr></thead><tbody><tr><td><code>veneer_savings_plan_utilization_percent</code></td><td>Gauge</td><td><code>type</code>, <code>instance_family</code>, <code>region</code></td><td>Savings Plan utilization percentage.</td></tr><tr><td><code>veneer_savings_plan_remaining_capacity_dollars</code></td><td>Gauge</td><td><code>type</code>, <code>instance_family</code>, <code>region</code></td><td>Savings Plan remaining capacity in dollars per hour.</td></tr></tbody></table><p><strong>Label values:</strong></p><table><thead><tr><th>Label</th><th>Values</th><th>Description</th></tr></thead><tbody><tr><td><code>type</code></td><td>SP type identifier</td><td>Type of Savings Plan</td></tr><tr><td><code>instance_family</code></td><td>Family name or <code>all</code></td><td>Instance family (or <code>all</code> for Compute SPs)</td></tr><tr><td><code>region</code></td><td>AWS region or <code>global</code></td><td>Region scope</td></tr></tbody></table><h2 id=nodeoverlay-lifecycle-metrics>NodeOverlay Lifecycle Metrics</h2><table><thead><tr><th>Metric</th><th>Type</th><th>Labels</th><th>Description</th></tr></thead><tbody><tr><td><code>veneer_overlay_operations_total</code></td><td>Counter</td><td><code>operation</code>, <code>capacity_type</code></td><td>Total NodeOverlay operations.</td></tr><tr><td><code>veneer_overlay_operation_errors_total</code></td><td>Counter</td><td><code>operation</code>, <code>error_type</code></td><td>Total NodeOverlay operation errors.</td></tr><tr><td><code>veneer_overlay_count</code></td><td>Gauge</td><td><code>capacity_type</code></td><td>Current number of NodeOverlays managed by Veneer.</td></tr></tbody></table><p><strong>Label values:</strong></p><table><thead><tr><th>Label</th><th>Values</th><th>Description</th></tr></thead><tbody><tr><td><code>operation</code></td><td><code>create</code>, <code>update</code>, <code>delete</code></td><td>Type of overlay operation</td></tr><tr><td><code>capacity_type</code></td><td><code>compute_savings_plan</code>, <code>ec2_instance_savings_plan</code>, <code>reserved_instance</code>, <code>preference</code></td><td>Capacity type the overlay targets</td></tr><tr><td><code>error_type</code></td><td><code>validation</code>, <code>api</code>, <code>not_found</code></td><td>Type of error encountered</td></tr></tbody></table><h2 id=prometheus-query-metrics>Prometheus Query Metrics</h2><table><thead><tr><th>Metric</th><th>Type</th><th>Labels</th><th>Description</th></tr></thead><tbody><tr><td><code>veneer_prometheus_query_duration_seconds</code></td><td>Histogram</td><td><code>query_type</code></td><td>Duration of Prometheus queries to Lumina. Uses default Prometheus buckets.</td></tr><tr><td><code>veneer_prometheus_query_errors_total</code></td><td>Counter</td><td><code>query_type</code></td><td>Total Prometheus query errors.</td></tr><tr><td><code>veneer_prometheus_query_result_count</code></td><td>Gauge</td><td><code>query_type</code></td><td>Number of results returned by the last Prometheus query.</td></tr></tbody></table><p><strong>Label values for <code>query_type</code>:</strong></p><table><thead><tr><th>Value</th><th>Description</th></tr></thead><tbody><tr><td><code>sp_utilization</code></td><td>Savings Plan utilization query</td></tr><tr><td><code>sp_capacity</code></td><td>Savings Plan remaining capacity query</td></tr><tr><td><code>ri</code></td><td>Reserved Instance count query</td></tr><tr><td><code>data_freshness</code></td><td>Lumina data freshness check</td></tr></tbody></table><h2 id=configuration-metrics>Configuration Metrics</h2><table><thead><tr><th>Metric</th><th>Type</th><th>Labels</th><th>Description</th></tr></thead><tbody><tr><td><code>veneer_config_overlays_disabled</code></td><td>Gauge</td><td>&ndash;</td><td><code>1</code> if overlay creation is disabled (dry-run mode), <code>0</code> if enabled.</td></tr><tr><td><code>veneer_config_utilization_threshold_percent</code></td><td>Gauge</td><td>&ndash;</td><td>Configured utilization threshold for overlay deletion.</td></tr></tbody></table><h2 id=info-metric>Info Metric</h2><table><thead><tr><th>Metric</th><th>Type</th><th>Labels</th><th>Description</th></tr></thead><tbody><tr><td><code>veneer_info</code></td><td>Gauge</td><td><code>version</code>, <code>disabled_mode</code></td><td>Controller information. Always set to <code>1</code>.</td></tr></tbody></table><h2 id=example-promql-queries>Example PromQL Queries</h2><h3 id=reconciliation-health>Reconciliation Health</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-promql data-lang=promql><span style=display:flex><span><span style=color:#75715e># Reconciliation error rate (last 5 minutes)</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>rate</span><span style=color:#f92672>(</span>veneer_reconciliation_total{result<span style=color:#f92672>=</span>&#34;<span style=color:#e6db74>error</span>&#34;}[<span style=color:#e6db74>5m</span>]<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>/</span> <span style=color:#66d9ef>rate</span><span style=color:#f92672>(</span>veneer_reconciliation_total[<span style=color:#e6db74>5m</span>]<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Average reconciliation duration</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>rate</span><span style=color:#f92672>(</span>veneer_reconciliation_duration_seconds_sum[<span style=color:#e6db74>5m</span>]<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#f92672>/</span> <span style=color:#66d9ef>rate</span><span style=color:#f92672>(</span>veneer_reconciliation_duration_seconds_count[<span style=color:#e6db74>5m</span>]<span style=color:#f92672>)</span>
</span></span></code></pre></div><h3 id=data-source-health>Data Source Health</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-promql data-lang=promql><span style=display:flex><span><span style=color:#75715e># Alert if Lumina data is unavailable</span>
</span></span><span style=display:flex><span>veneer_lumina_data_available <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Data freshness in minutes</span>
</span></span><span style=display:flex><span>veneer_lumina_data_freshness_seconds <span style=color:#f92672>/</span> <span style=color:#ae81ff>60</span>
</span></span></code></pre></div><h3 id=overlay-activity>Overlay Activity</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-promql data-lang=promql><span style=display:flex><span><span style=color:#75715e># Overlay creation rate by capacity type</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>rate</span><span style=color:#f92672>(</span>veneer_overlay_operations_total{operation<span style=color:#f92672>=</span>&#34;<span style=color:#e6db74>create</span>&#34;}[<span style=color:#e6db74>1h</span>]<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Current overlay count</span>
</span></span><span style=display:flex><span>veneer_overlay_count
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Overlay operation error rate</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>rate</span><span style=color:#f92672>(</span>veneer_overlay_operation_errors_total[<span style=color:#e6db74>5m</span>]<span style=color:#f92672>)</span>
</span></span></code></pre></div><h3 id=savings-plans-monitoring>Savings Plans Monitoring</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-promql data-lang=promql><span style=display:flex><span><span style=color:#75715e># SP utilization across all types</span>
</span></span><span style=display:flex><span>veneer_savings_plan_utilization_percent
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Remaining SP capacity ($/hour)</span>
</span></span><span style=display:flex><span>veneer_savings_plan_remaining_capacity_dollars
</span></span></code></pre></div><h2 id=grafana-dashboard>Grafana Dashboard</h2><p>You can build a Grafana dashboard using these metrics. Key panels to include:</p><ol><li><strong>Reconciliation Status</strong> &ndash; Success/error rate over time</li><li><strong>Lumina Data Freshness</strong> &ndash; Gauge showing data age</li><li><strong>Overlay Count</strong> &ndash; Breakdown by capacity type</li><li><strong>Decision Activity</strong> &ndash; Create vs delete decisions over time</li><li><strong>Prometheus Query Performance</strong> &ndash; Query latency and error rates</li><li><strong>SP Utilization</strong> &ndash; Per-type utilization percentages</li></ol></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/nextdoor/veneer aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2026
<span class=td-footer__authors>The Veneer Authors</span></span><span class=td-footer__all_rights_reserved>All Rights Reserved</span></div></div></div></footer></div><script src=/veneer/js/main.min.4a7a8cc982d6f5fa05fafe95c8fcbc9cd50dee051600e57e7d587df2d2a35b07.js integrity="sha256-SnqMyYLW9foF+v6VyPy8nNUN7gUWAOV+fVh98tKjWwc=" crossorigin=anonymous></script><script defer src=/veneer/js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=/veneer/js/tabpane-persist.js></script></body></html>